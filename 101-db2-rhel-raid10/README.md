# Deploy a DB2 instance on a single VM with data disk on a RAID10 volume, on RHEL 7.4

This quickstart template deploys a fully functional IBM DB2 instance in Azure on a RHEL7.4 (pay-as-you-go) VM. It takes long time to finish (downloading, extracting, installing DB2 takes the most time)

<a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fms-cse%2Fazure-quickstart-templates%2F101-db2-rhel-raid10%2F101-db2-rhel-raid10%2Fazuredeploy.json" target="_blank">
    <img src="http://azuredeploy.net/deploybutton.png"/>
</a>
<a href="http://armviz.io/#/?load=https%3A%2F%2Fraw.githubusercontent.com%2Fms-cse%2Fazure-quickstart-templates%2F101-db2-rhel-raid10%2F101-db2-rhel-raid10%2Fazuredeploy.parameters.json" target="_blank">
    <img src="http://armviz.io/visualizebutton.png"/>
</a>


To deploy the template in Azure:

```
az group create -l westeurope -n db2

az group deployment create -n db2deployment -g db2 --template-file azure.deploy.json --parameters azure.parameters.json
```

If you want to use just azure-cli commands, you can deploy passing the script as cloud-init custom data:

```
az group create -n db2

az network nsg create -g db2 -n db2
az network nsg rule create --nsg-name db2 -g db2 --name allow-db2 --description "DB2" --protocol tcp --priority 100 --destination-port-range "50000"
az network nsg rule create --nsg-name db2 -g db2 --name allow-ssh --description "DB2" --protocol tcp --priority 101 --destination-port-range "22"

az vm create --resource-group db2 --name db2 --image RedHat:RHEL:7-RAW-CI:latest --size Standard_DS2_v2 --admin-username rhel --data-disk-sizes-gb 10 10 10 10 --nsg db2 --custom-data ./db2_setup.sh --no-wait
```


## Parameters

Parameter | Description | Default
--- | --- | ---
`db2_user` | name of the db2 user | `db2user`
`db2_password` | password of the db2 user | `autogenerated`
`vm_name` | name of the db2 VM | `db2`
`disk_size` | Size of the managed data disks, in GB | `10`
`sshUserName` | name of the linux user | `rhel`
`sshPublicKey` | SSH public key | `autogenerated`
`script_url` | URL for the provisioning script | `https://raw.githubusercontent.com/ms-cse/azure-quickstart-templates/master/101-db2-rhel/scripts/db2_setup.sh`
